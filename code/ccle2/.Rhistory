knitr::opts_chunk$set(echo = TRUE)
options(width=96)
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean, "X.Rda")
)
dim(x)
dim(X)
View(X[1:3, 1:10])
load(file.path(paths$clean, "mut.Rda"))
dim(Xmut)
sum(apply(Xmut, 1, sum) == 0)
load(file.path(paths$clean, "cp.Rda"))
dim(Xcp)
sum(apply(Xcp, 1, sum) == 0)
load(file.path(paths$clean, "exp.Rda"))
dim(Xexp)
sum(apply(Xexp, 1, sum) == 0)
load(file.path(paths$clean, "rppa.Rda"))
dim(Xrppa)
sum(apply(Xrppa, 1, sum) == 0)
X <- cbind(Xmut, Xcp, Xexp, Xrppa)
print(paste("Number of mutations that never happend:", sum(apply(Xmut, 2, sum) == 0)))
print(paste("Number of copy number that never happend:", sum(apply(Xcp, 1, sum) == 0)))
print(paste("Number of copy number that never happend:", sum(apply(Xcp, 2, sum) == 0)))
print(paste("Number of cell lines with no gene expressions:", sum(apply(Xexp, 1, sum) == 0)))
load(file.path(paths$clean, "mut.Rda"))
dim(Xmut)
print(paste("Number of cell lines with no mutation:", sum(apply(Xmut, 1, sum) == 0)))
load(file.path(paths$clean, "cp.Rda"))
dim(Xcp)
print(paste("Number of cell lines with no copy number change:", sum(apply(Xcp, 1, sum) == 0)))
load(file.path(paths$clean, "exp.Rda"))
dim(Xexp)
print(paste("Number of cell lines with no gene expressions:", sum(apply(Xexp, 1, sum) == 0)))
load(file.path(paths$clean, "rppa.Rda"))
dim(Xrppa)
print(paste("Number of cell lines with no protein expressions:", sum(apply(Xrppa, 1, sum) == 0)))
X <- cbind(Xmut, Xcp, Xexp, Xrppa)
dim(X)
X[100:105, c(1:5, 20000:20010, 50000:50010, 98600:98610)]
# Remove all samples for which no expression or no rppa is measured
X <- X[apply(Xexp, 1, sum) != 0 & apply(Xrppa, 1, sum) != 0, ]
dim(X)
save(X, file = file.path(paths$clean, "X.Rda"))
drugs <- read.csv(file.path(paths$raw, "CCLE_NP24.2009_Drug_data_2015.02.24.csv"), header = T, check.names =  FALSE, header = T, stringsAsFactors = F)
drugs <- read.csv(file.path(paths$raw, "CCLE_NP24.2009_Drug_data_2015.02.24.csv"), header = T, check.names =  FALSE, stringsAsFactors = F)
dim(drugs)
head(drugs)
sampleNames <- unique(sort(as.character(drugs$CCLE.Cell.Line.Name)))
length(sampleNames)
fileName <- file.path(paths$clean,"doseResponse.Rda")
doseResponse <- drugs[,c("Compound", "CCLE Cell Line Name","IC50 (uM)", "ActArea")]
colnames(doseResponse) <- c("compound", "clName", "ic50", "actArea")
save(doseResponse, file=fileName)
doseResponse
View(doseResponse)
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
unique(doseResponse$compound)
aa <-unique(doseResponse$compound)
class(aa)
View(doseResponse)
sum(doseResponse$compound == drug & doseResponse$clName %in% rownames(X))
drug <- aa[1]
sum(doseResponse$compound == drug & doseResponse$clName %in% rownames(X))
aa <- as.data.frame(matrix(1:10, 2, 5))
aa
colnames(aa) <- c("a", "b", "c")
aa
colnames(aa) <- c("a", "b", "c", "d", "d")
aa
colnames(aa) <- c("a", "b", "c", "d", "e")
aa$d
aa$f <- c(50, 11)
aa
aa[, -f]
subset(aa, select = -c(f))
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- X[rownames(X) %in% y$clName, ]
dim(xyt)
rownames(xyt)[1:5]
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- X[rownames(X) %in% y$clName, ]
xyt$y <- y$ic50[y$clName == rownames(xyt)]
xyt$y[1:10]
]]]
rownames(xyt)[1:5]
dim(xyt)
class(xyt)
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- X[rownames(X) %in% y$clName, ]
aa <- y$ic50[y$clName == rownames(xyt)]
class(aa)
class(xyt)
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- as.data.frame(X[rownames(X) %in% y$clName, ])
xyt <- as.data.frame(X[rownames(X) %in% y$clName, ])
xyt$y <- y$ic50[y$clName == rownames(xyt)]
rownames(xyt)[1:5]
xyt$y[1:10]
rownames(xyt)[1:10]
View(xyt$y)
rownames(X) %in% y$clName
sum(rownames(X) %in% y$clName)
dim(y)
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- as.data.frame(X[y$clName %in% rownames(X), ])
dim(y)
dim(*)xyt)
dim(xyt)
y <- doseResponse[doseResponse$compound == drug, ]
dim(y)
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
aa <- as.data.frame(matrix(9, 3,3))
aaa
aa
aa <- as.data.frame(matrix(1:9, 3,3))
aa
rownames(aa) <- c("a", "b", "c")
aa
aa <- as.data.frame(matrix(1:16, 4,4))
aa
rownames(aa) <- c("a", "b", "c", "d")
aa
bb <- aa[c("c", "d", "a"),]
bb
bb$nam <- c("c", "d", "a")
bb
aa <- y$clName[1]
aa
strsplit(aa, "_")
aa <- y$clName[1:3]
strsplit(aa, "_")
bb <- strsplit(aa, "_")
bb
bb[[1]]
bb[1]
paste(bb[[1]][1:length(b[[1]])])
paste(bb[[1]][1:length(bb[[1]])])
paste(bb[[1]][2:length(bb[[1]])], sep = "_")
paste(bb[[1]][2:length(bb[[1]])], sep = "_", collapse = "")
paste(bb[[1]][2:length(bb[[1]])], collapse = "_")
?lapply
sampleNames <- y$clName
sapply(strsplit(sampleNames), function(x) paste(x[[1]][2:length(x[[1]])]))
sapply(strsplit(sampleNames, "_"), function(x) paste(x[[1]][2:length(x[[1]])], collapse = "_"))
sapply(strsplit(sampleNames, "_"), function(x) print(x))
temp <- strsplit(sampleNames, "_")
View(temp)
lapply(temp, function(x) print(x))
temp <- strsplit(sampleNames, "_")
apply(temp, function(x) paste(x[2:length(x)], collapse = "_")))
apply(temp, function(x) paste(x[2:length(x)], collapse = "_"))
sapply(temp, function(x) paste(x[2:length(x)], collapse = "_"))
View(y$clName)
aa <- sapply(strsplit(y$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
class(aa)
unique(aa)
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
for(drug in unique(doseResponse$compound)){
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- as.data.frame(X[y$clName, ])
xyt$yic50 <- y$ic50
xyt$yaa <- y$actArea
# extractCancerType
xyt$t <- sapply(strsplit(y$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
save(xyt, file = file.path(paths$clean, paste("xyt", drug, sep = "_")))
}
for(drug in unique(doseResponse$compound)){
print(paste("Processing", drug))
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- as.data.frame(X[y$clName, ])
xyt$yic50 <- y$ic50
xyt$yaa <- y$actArea
# extractCancerType
xyt$t <- sapply(strsplit(y$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
save(xyt, file = file.path(paths$clean, paste("xyt", drug, sep = "_")))
}
file.path(paths$clean, paste("xyt_", drug, ".Rda", sep = ""))
load("D:/database/dataenrichment/clean//xyt_Erlotinib")
rm(xyt)
load("D:/database/dataenrichment/clean//xyt_Erlotinib")
hist(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
class(doseResponse$clName)
sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
hist(as.factor(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))))
?hist
barplot(prop.table(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))))))
barplot(prop.table(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))))
?barplot
barplot(prop.table(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))), angle = 45)
barplot(prop.table(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))), angle = 90)
?table
aa <- sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
aa <- sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
table(aa)
allTreatedSamples <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) paste(x[2:length(x)], collapse = "_"))
table(allTreatedSamples)
tt <- table(allTreatedSamples)
sum(tt)
prop.table(tt)
?prop.table
m <- matrix(1:4, 2)
m
prop.table(m, 1)
barplot(prop.table(table(allTreatedSamples)), las = 2)
barplot(prop.table(sort(table(allTreatedSamples))), las = 2)
barplot(prop.table(sort(table(allTreatedSamples))), las = 2, cex.axis = .5)
barplot(prop.table(sort(table(allTreatedSamples))), las = 2, cex.names = .5)
aa <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) print(x))
barplot(prop.table(sort(table(allTreatedSamples))), las = 2, cex.names = .5)
y[y$clName == "M059J",]
doseResponse[doseResponse$clName == "M059J",]
sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) print(x))
temp <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) print(x))
clWitoutType <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) print(x))
clWitoutType
clWithoutType <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) print(x))
clWithoutType
class(clWithoutType)
clWithoutType <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) x else NA)
clWithoutType
clWithoutType <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) T else F)
doseResponse$clName[clWithoutType]
strsplit("NCIH1666_LUNG", "_")
aa <- strsplit("NCIH1666_LUNG", "_")
length(aa[[1]])
clWithoutType <- sapply(strsplit(unique(doseResponse$clName), "_"), function(x) if(length(x) == 1) TRUE else FALSE)
sum(clWithoutType)
doseResponse$clName[clWithoutType]
length(clWithoutTypeclWithoutType)
length(clWithoutType)
clWithoutType <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
unique(doseResponse$clName[clWithoutType])
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName == clWithoutType,]
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
dim(X)
X <- X[!clWithoutType, ]
X <- X[-clWithoutType, ]
sum(clWithoutType %in% rownames(X))
rownames(X)
sum(clWithoutType %in% rownames(X))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
rm(index, clWithoutType)
barplot(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)]))/24))
barplot(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))/24))
sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")
)
table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
temp <- sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
View(temp)
table(temp)
bb <- table(temp)
bb / 24
barplot(table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24)
barplot(sort(decreasing = T, table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24), las = 2)
barplot(sort(decreasing = T, table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24), las = 2, cex.names = .75)
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
rm(index, clWithoutType)
barplot(sort(decreasing = T, table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24), las = 2, cex.names = .75)
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
doseResponse <- doseResponse[doseResponse$clName != clWithoutType,]
sum(clWithoutType %in% rownames(X))
# rm(index, clWithoutType)
which(doseResponse$clName == "SF8657")
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
which(doseResponse$clName == "SF8657")
doseResponse[406]
doseResponse[406,]
doseResponse[which(doseResponse$clName == "SF8657"), ]
doseResponse[which(doseResponse$clName %in% clWithoutType), ]
aa <- doseResponse[which(doseResponse$clName %in% clWithoutType), ]
dim(aa)
doseResponse <- doseResponse[!(doseResponse$clName %in% clWithoutType),]
knitr::opts_chunk$set(echo = TRUE)
options(width=96)
cat('
<style type="text/css">
b, strong {color: red; }
i, em {color: blue; }
.defn {color: purple; }
.para {color: purple;
font-weight: bold;
}
.figure { text-align: center; }
.caption { font-weight: bold; }
</style>
')
rm(list=ls())
source("00-paths.R")
load(file.path(paths$clean,"doseResponse.Rda"))
load(file = file.path(paths$clean, "X.Rda"))
index <- sapply(strsplit(doseResponse$clName, "_"), function(x) if(length(x) == 1) TRUE else FALSE)
clWithoutType <- unique(doseResponse$clName[index])
dim(doseResponse)
doseResponse <- doseResponse[!(doseResponse$clName %in% clWithoutType),]
dim(doseResponse)
sum(clWithoutType %in% rownames(X))
# rm(index, clWithoutType)
barplot(sort(decreasing = T, table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24), las = 2, cex.names = .75)
barplot(sort(decreasing = T, table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))) / 24), las = 2, cex.names = .75)
print(counts/ 24 > 20)
counts <- table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
print(counts/ 24 > 20)
print(names(counts/ 24 > 20))
print(names(counts)[counts/ 24 > 20])
counts <- table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
barplot(sort(decreasing = T,  counts / 24), las = 2, cex.names = .75)
print(names(counts)[counts/ 24 > 20])
for(drug in unique(doseResponse$compound)){
print(paste("Processing", drug))
y <- doseResponse[doseResponse$compound == drug & doseResponse$clName %in% rownames(X), ]
xyt <- as.data.frame(X[y$clName, ])
xyt$yic50 <- y$ic50
xyt$yaa <- y$actArea
# extractCancerType
xyt$t <- sapply(strsplit(y$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_"))
save(xyt, file = file.path(paths$clean, paste("xyt_", drug, ".Rda", sep = "")))
}
counts <- table(sapply(strsplit(doseResponse$clName, "_"), function(x) paste(x[2:length(x)], collapse = "_")))
barplot(sort(decreasing = T,  counts / 24), las = 2, cex.names = .75)
print(names(counts)[counts/ 24 > 20])
focusTypes <- c("LUNG", "HAEMATOPOIETIC_AND_LYMPHOID_TISSUE")
dim(xyt)
xyt <- xyt[xyt$t %in% focusTypes, ]
dim(xyt)
expand.grid(1:3, 4:6)
expand.grid(a = 1:3, 4:6)
focusTypes <- c("LUNG", "HAEMATOPOIETIC_AND_LYMPHOID_TISSUE")
lambda <- c(.0001, .001, .01, .1, 1, 3, 5)
alpha <- c(.1, .2, .3, .4, .5, .6, .7, .8, .9)
expand.grid(lambda = lambda, alpha  = alpha)
paramGrid <- expand.grid(lambda = lambda, alpha  = alpha)
paramGrid
library(glmnet)
?glmnet
